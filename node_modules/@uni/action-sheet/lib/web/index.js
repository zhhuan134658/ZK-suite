"use strict";

exports.__esModule = true;
exports.default = void 0;

var _common = require("../common");

var _constant = require("../_utils/constant");

var clsPrefix = '__universal_actionsheet';
var styles = ("." + clsPrefix + " {\n  position: fixed;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: #fff;\n  color: #000;\n  box-sizing: border-box;\n  border-radius: 12px 12px 0 0;\n  transform: translateY(100%);\n  -webkit-transform: translateY(100%);\n  z-index: 9999;\n  outline: none;\n  text-align: center;\n  animation-duration: .3s;\n  animation-fill-mode: both;\n}\n." + clsPrefix + "_mask {\n  content: \"\";\n  position: fixed;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  top: 0;\n  margin: auto;\n  display: block;\n  z-index: 9999;\n  background: #000;\n  opacity: 0;\n  animation-duration: .3s;\n  animation-fill-mode: both;\n}\n." + clsPrefix + "_item {\n  padding: 16px 0;\n  border-bottom: 1px solid #eee;\n}\n." + clsPrefix + "_cancel {\n  padding: 16px 0;\n  border-top: 10px solid #eee;\n}\n@keyframes " + clsPrefix + "_slideIn {\n  0% {\n    transform: translateY(100%);\n    -webkit-transform: translateY(100%);\n  }\n  100% {\n    transform: translateY(0);\n    -webkit-transform: translateY(0);\n  }\n}\n@keyframes " + clsPrefix + "_slideOut {\n  0% {\n    transform: translateY(0);\n    -webkit-transform: translateY(0);\n  }\n  100% {\n    transform: translateY(100%);\n    -webkit-transform: translateY(100%);\n  }\n}\n@keyframes " + clsPrefix + "_fadeIn {\n  0% {\n    opacity: 0;\n  }\n  100% {\n    opacity: .6;\n  }\n}\n@keyframes " + clsPrefix + "_fadeOut {\n  0% {\n    opacity: .6;\n  }\n  100% {\n    opacity: 0;\n  }\n}").replace(/\n/g, '');
var styleElement = null;
var actionSheetElement = null;

var hideFn = function hideFn() {};

var hideCallback = function hideCallback() {};

var showActionSheet = function showActionSheet(args) {
  try {
    if (!styleElement) {
      // create a style tag for keyframes
      styleElement = document.createElement('style');
      styleElement.innerHTML = styles;
      document.body.appendChild(styleElement);
    }

    if (!actionSheetElement) {
      // create a actionsheet element
      actionSheetElement = document.createElement('div'); // create a mask element

      var maskEle = document.createElement('div');
      maskEle.className = clsPrefix + "_mask";
      maskEle.addEventListener('click', function () {
        hideCallback(-1);
      });
      actionSheetElement.appendChild(maskEle); // create container element

      var containerEle = document.createElement('div');
      containerEle.className = clsPrefix; // add all item element

      var itemList = args.itemList || [];

      var _loop = function _loop(index) {
        var itemEle = document.createElement('div');
        itemEle.className = clsPrefix + "_item";
        itemEle.innerText = itemList[index]; // support for ARIA, add tabindex for focus
        // https://developer.mozilla.org/zh-CN/docs/Web/HTML/Global_attributes/tabindex

        itemEle.setAttribute('tabindex', "" + index); // eslint-disable-next-line no-loop-func

        itemEle.addEventListener('click', function () {
          hideCallback(index);
        });
        containerEle.appendChild(itemEle);
      };

      for (var index = 0; index < itemList.length; index++) {
        _loop(index);
      } // add cancel element


      var cancelEle = document.createElement('div');
      cancelEle.className = clsPrefix + "_cancel";
      cancelEle.innerText = '取消';
      cancelEle.setAttribute('tabindex', '-1');
      cancelEle.addEventListener('click', function () {
        hideCallback(-1);
      });
      containerEle.appendChild(cancelEle);
      actionSheetElement.appendChild(containerEle);
      document.body.appendChild(actionSheetElement);
      maskEle.style.animationName = clsPrefix + "_fadeIn";
      containerEle.style.animationName = clsPrefix + "_slideIn";

      hideFn = function hideFn(callback) {
        maskEle.style.animationName = clsPrefix + "_fadeOut";
        containerEle.style.animationName = clsPrefix + "_slideOut";
        setTimeout(function () {
          document.body.removeChild(actionSheetElement);
          actionSheetElement = null;
          callback();
        }, 300);
      };

      hideCallback = function hideCallback(index) {
        hideFn(function () {
          args.success({
            tapIndex: index
          });
          args.complete({
            tapIndex: index
          });
        });
      };
    }
  } catch (err) {
    args.fail(err);
    args.complete(err);
  }
};

var _default = (0, _common.normalize)(showActionSheet, _constant.CONTAINER_NAME.WEB);

exports.default = _default;