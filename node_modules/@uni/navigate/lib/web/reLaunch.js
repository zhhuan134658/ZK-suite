"use strict";

exports.__esModule = true;
exports.reLaunch = exports.default = void 0;

var _common = require("../common");

var _constant = require("../_utils/constant");

var _replace = _interopRequireDefault(require("./replace"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var reLaunch = _common.normalize.reLaunch(function (options) {
  var url = options.url,
      _options$isHash = options.isHash,
      isHash = _options$isHash === void 0 ? false : _options$isHash,
      _options$refresh = options.refresh,
      refresh = _options$refresh === void 0 ? true : _options$refresh,
      success = options.success,
      fail = options.fail,
      complete = options.complete;

  var _url = isHash ? "/#" + url : url;

  setTimeout(function () {
    try {
      history.go(-(history.length - 1));

      if ((url.indexOf('https://') !== -1 || url.indexOf('https://') !== -1) && url.indexOf(location.origin) === -1) {
        console.warn('Uni API: Relaunch does not support cross-domain');
        location.href = url;
        return;
      }

      if (isHash) {
        (0, _replace.default)({
          url: url,
          isHash: true
        });
      } else {
        window.history.replaceState(null, null, _url);
        refresh && location.reload();
      }

      success && success();
      complete && complete();
    } catch (e) {
      fail && fail(e);
      complete && complete(e);
    }
  });
}, _constant.CONTAINER_NAME.WEB);

exports.reLaunch = reLaunch;
var _default = reLaunch;
exports.default = _default;